var $event=$.event,resizeTimeout,Grid,$special=$event.special.debouncedresize={setup:function(){$(this).on("resize",$special.handler)},teardown:function(){$(this).off("resize",$special.handler)},handler:function(e,t){var s=this,o=arguments,n=function(){e.type="debouncedresize",$event.dispatch.apply(s,o)};resizeTimeout&&clearTimeout(resizeTimeout),t?n():resizeTimeout=setTimeout(n,$special.threshold)},threshold:250},BLANK="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";$.fn.imagesLoaded=function(e){var s=this,t=typeof $.Deferred=="function"?$.Deferred():0,l=typeof t.notify=="function",n=s.find("img").add(s.filter("img")),i=[],a=[],o=[];$.isPlainObject(e)&&$.each(e,function(n,s){n==="callback"?e=s:t&&t[n](s)});function c(){var i=$(a),r=$(o);t&&(o.length?t.reject(n,i,r):t.resolve(n)),typeof e=="function"&&e.call(s,n,i,r)}function r(e,s){if(e.src===BLANK||$.inArray(e,i)!==-1)return;i.push(e),s?o.push(e):a.push(e),$.data(e,"imagesLoaded",{isBroken:s,src:e.src}),l&&t.notifyWith($(e),[s,n,$(a),$(o)]),n.length===i.length&&(setTimeout(c),n.off(".imagesLoaded"))}return n.length?n.on("load.imagesLoaded error.imagesLoaded",function(e){r(e.target,e.type==="error")}).each(function(e,t){var s=t.src,n=$.data(t,"imagesLoaded");if(n&&n.src===s){r(t,n.isBroken);return}if(t.complete&&t.naturalWidth!==void 0){r(t,t.naturalWidth===0||t.naturalHeight===0);return}(t.readyState||t.complete)&&(t.src=BLANK,t.src=s)}):c(),t?t.promise(s):s},Grid=function(){var n,f=$("*#og-grid"),t=f.children("li"),s=-1,a=-1,r=0,l=10,d=$(window),v=$("html, body"),g={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},i=g[Modernizr.prefixed("transition")],o=Modernizr.csstransitions,e={minHeight:500,speed:350,easing:"ease"};function b(t){e=$.extend(!0,{},e,t),f.imagesLoaded(function(){u(!0),m(),y()})}function j(e){t=t.add(e),e.each(function(){var e=$(this);e.data({offsetTop:e.offset().top,height:e.height()})}),h(e)}function u(e){t.each(function(){var t=$(this);t.data("offsetTop",t.offset().top),e&&t.data("height",t.height())})}function y(){h(t),d.on("debouncedresize",function(){r=0,a=-1,u(),m();var e=$.data(this,"preview");typeof e!="undefined"&&c()})}function h(e){e.on("click","span.og-close",function(){return c(),!1}).children("a").on("click",function(){var n=$(this).parent();return s===Array.from(e).findIndex(e=>e==n[0])?c():_(n),!1})}function m(){n={width:d.width(),height:d.height()}}function _(e){var t=$.data(this,"preview"),n=e.data("offsetTop");if(r=0,typeof t!="undefined")if(a!==n)n>a&&(r=t.height),c();else return t.update(e),!1;a=n,t=$.data(this,"preview",new p(e)),t.open()}function c(){s=-1;var e=$.data(this,"preview");e.close(),$.removeData(this,"preview")}function p(e){this.$item=e,this.expandedIdx=Array.from(t).findIndex(e=>e==this.$item[0]),this.create(),this.update()}return p.prototype={create:function(){this.$title=$("<h3></h3>"),this.$description=$("<p></p>"),this.$href=$('<a href="#" class="button" target="_blank" rel="noreferrer">{{ .Site.Params.buttontext }}</a>'),this.$details=$('<div class="og-details"></div>').append(this.$title,this.$description,this.$href),this.$loading=$('<div class="og-loading"></div>'),this.$fullimage=$('<div class="og-fullimg"></div>').append(this.$loading),this.$closePreview=$('<span class="og-close"></span>'),this.$previewInner=$('<div class="og-expander-inner"></div>').append(this.$closePreview,this.$fullimage,this.$details),this.$previewEl=$('<div class="og-expander"></div>').append(this.$previewInner),this.$item.append(this.getEl()),o&&this.setTransition()},update:function(e){e&&(this.$item=e),s!==-1&&(a=t.eq(s),a.removeClass("og-expanded"),this.$item.addClass("og-expanded"),this.positionPreview()),s=this.$item.index();function r(e){return e.replace(/_/g,"-").replace(/ /g,"-").replace(/:/g,"-").replace(/\\/g,"-").replace(/\//g,"-").replace(/[^a-zA-Z0-9-]+/g,"").replace(/-{2,}/g,"-").toLowerCase()}var n,a,i=this.$item.children("a"),o={href:i.attr("href"),largesrc:i.data("largesrc"),title:i.data("title"),description:$(`#description-${r(i.data("title"))}`).html(),buttontext:i.data("buttontext")};this.$title.html(o.title),this.$description.html(o.description),o.buttontext?this.$href.text(o.buttontext):this.$href.text("{{ .Site.Params.buttontext }}"),o.href?(this.$href.attr("href",o.href),this.$href.show()):this.$href.hide(),n=this,typeof n.$largeImg!="undefined"&&n.$largeImg.remove(),n.$fullimage.is(":visible")&&(this.$loading.show(),$("<img/>").on("load",function(){var e=$(this);e.attr("src")===n.$item.children("a").data("largesrc")&&(n.$loading.hide(),n.$fullimage.find("img").remove(),n.$largeImg=e.fadeIn(350),n.$fullimage.append(n.$largeImg))}).attr("src",o.largesrc))},open:function(){setTimeout($.proxy(function(){this.setHeights(),this.positionPreview()},this),25)},close:function(){var e=this,n=function(){o&&$(this).off(i),e.$item.removeClass("og-expanded"),e.$previewEl.remove()};return setTimeout($.proxy(function(){typeof this.$largeImg!="undefined"&&this.$largeImg.fadeOut("fast"),this.$previewEl.css("height",0);var e=t.eq(this.expandedIdx);e.css("height",e.data("height")).on(i,n),o||n.call()},this),25),!1},calcHeight:function(){var t=n.height-this.$item.data("height")-l,s=n.height;t<e.minHeight&&(t=e.minHeight,s=e.minHeight+this.$item.data("height")+l),this.height=t,this.itemHeight=s},setHeights:function(){var e=this,t=function(){o&&e.$item.off(i),e.$item.addClass("og-expanded")};this.calcHeight(),this.$previewEl.css("height",this.height),this.$item.css("height",this.itemHeight).on(i,t),o||t.call()},positionPreview:function(){var s=this.$item.data("offsetTop"),t=this.$previewEl.offset().top-r,o=this.height+this.$item.data("height")+l<=n.height?s:this.height<n.height?t-(n.height-this.height):t;v.animate({scrollTop:o},e.speed)},setTransition:function(){this.$previewEl.css("transition","height "+e.speed+"ms "+e.easing),this.$item.css("transition","height "+e.speed+"ms "+e.easing)},getEl:function(){return this.$previewEl}},{init:b,addItems:j}}(),$(function(){Grid.init()})